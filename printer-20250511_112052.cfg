# See docs/Config_Reference.md for a description of parameters.

[include stealthburner_leds.cfg]
[include fluidd.cfg]
#[include mainsail.cfg]
[include macros.cfg]
[include config_backup.cfg]
[include homing.cfg]
[include ebbcan.cfg]
[include nozzle_scrub.cfg]
[include bttsfs.cfg]
[include cartographer.cfg]

[exclude_object]

[force_move]
enable_force_move: True

[mcu]
canbus_uuid: 0f62cf317224

[mcu EBBCan]
canbus_uuid: 77d68f365864

[mcu scanner]
canbus_uuid: 1f11a464b055

[printer]
kinematics: corexy
max_velocity: 500  
max_accel: 20000             #Max 4000
max_z_velocity: 15          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 500
square_corner_velocity: 5.0

[input_shaper]
shaper_freq_x: 58.4
shaper_type_x: mzv
shaper_freq_y: 46.2
shaper_type_y: mzv

[respond]
default_type: echo
#   Sets the default prefix of the "M118" and "RESPOND" output to one
#   of the following:
#       echo: "echo: " (This is the default)
#       command: "// "
#       error: "!! "
#default_prefix: echo:
#   Directly sets the default prefix. If present, this value will
#   override the "default_type".

#####################################################################
#   X/Y Stepper Settings
#####################################################################

##  B Stepper - Left
[stepper_x]
step_pin: PF13
dir_pin: PF12
enable_pin: !PF14
rotation_distance: 40
microsteps: 32
full_steps_per_rotation:400  #set to 200 for 1.8 degree stepper
endstop_pin: tmc2209_stepper_x:virtual_endstop
position_min: 0
position_endstop: 301.5
position_max: 301.5
homing_speed: 40   #Max 100
homing_retract_dist: 0
homing_positive_dir: true

[tmc2209 stepper_x]
uart_pin: PC4
diag_pin: ^PG6
driver_SGTHRS: 144
interpolate: false
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

##  A Stepper - Right
[stepper_y]
step_pin: PG0
dir_pin: PG1
enable_pin: !PF15
rotation_distance: 40
microsteps: 32
full_steps_per_rotation:400  #set to 200 for 1.8 degree stepper
endstop_pin: tmc2209_stepper_y:virtual_endstop
position_min: 0
position_endstop: 305
position_max: 305
homing_speed: 40  #Max 100
homing_retract_dist: 0
homing_positive_dir: true

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_y]
uart_pin: PD11
diag_pin: ^PG9
driver_SGTHRS: 144
interpolate: false
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0
 
#####################################################################
#   Z Stepper Settings
#####################################################################

## Z0 Stepper - Front Left
[stepper_z]
step_pin: PF11
dir_pin: PG3
enable_pin: !PG5
rotation_distance: 40
gear_ratio: 80:16
microsteps: 32
endstop_pin: probe:z_virtual_endstop
position_max: 260
position_min: -5
homing_speed: 8
second_homing_speed: 3
homing_retract_dist: 0 # Was 3 with Tap

[tmc2209 stepper_z]
uart_pin: PC6
interpolate: false
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 999999

##  Z1 Stepper - Rear Left
[stepper_z1]
step_pin: PG4
dir_pin: !PC1
enable_pin: !PA0
rotation_distance: 40
gear_ratio: 80:16
microsteps: 32

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_z1]
uart_pin: PC7
interpolate: false
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 999999

##  Z2 Stepper - Rear Right
[stepper_z2]
step_pin: PF9
dir_pin: PF10
enable_pin: !PG2
rotation_distance: 40
gear_ratio: 80:16
microsteps: 32

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_z2]
uart_pin: PF2
interpolate: false
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 999999

##  Z3 Stepper - Front Right
[stepper_z3]
step_pin: PC13
dir_pin: !PF0
enable_pin: !PF1
rotation_distance: 40
gear_ratio: 80:16
microsteps: 32

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_z3]
uart_pin: PE4
interpolate: false
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 999999


#####################################################################
#   Extruder
#####################################################################

[extruder]
step_pin: EBBCan: PD0
dir_pin: EBBCan: PD1
enable_pin: !EBBCan: PD2
rotation_distance: 22.6789511
gear_ratio: 50:10
microsteps: 32
full_steps_per_rotation: 200    #200 for 1.8 degree, 400 for 0.9 degree
nozzle_diameter: 0.400
filament_diameter: 1.75
heater_pin: EBBCan: PB13
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: EBBCan: PA3
min_temp: 10
max_temp: 300
max_power: 1.0
min_extrude_temp: 170
#control = pid
#pid_kp = 26.213
#pid_ki = 1.304
#pid_kd = 131.721
##  Try to keep pressure_advance below 1.0
pressure_advance: 0.035
##  Default is 0.040, leave stock
#pressure_advance_smooth_time: 0.040

##  E0 on MOTOR6
##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 extruder]
uart_pin: EBBCan: PA15
interpolate: false
run_current: 0.78
sense_resistor: 0.110
stealthchop_threshold: 0


#####################################################################
#   Bed Heater
#####################################################################

[heater_bed]
heater_pin: PA2
##  Validate the following thermistor type to make sure it is correct
##  Keenovo branded bed heaters should use Generic 3950
##  LDO branded bed heaters will have the sensor type labelled on the heater
## Check what thermistor type you have. See https://www.klipper3d.org/Config_Reference.html#common-thermistors for common thermistor types.
## Use "Generic 3950" for Keenovo heaters
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF3
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.6
min_temp: 0
max_temp: 120
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769


#####################################################################
#   Fan Control
#####################################################################

##  Print Cooling Fan - FAN0
[fan]
pin: EBBCan: PA1
kick_start_time: 0.5
##  Depending on your fan, you may need to increase this value
##  if your fan will not start. Can change cycle_time (increase)
##  if your fan is not able to slow down effectively
off_below: 0.10


##  Hotend Fan - FAN1
[heater_fan hotend_fan]
pin: EBBCan: PA0
max_power: 1.0
kick_start_time: 0.5
heater: extruder
heater_temp: 50.0
##  If you are experiencing back flow, you can reduce fan_speed
#fan_speed: 1.0

##  Controller fan - FAN2
[controller_fan controller_fan]
pin: PD12
kick_start_time: 0.56
fan_speed: 0.5
stepper: stepper_z

#####################################################################
#   LED Control
#####################################################################

[output_pin caselight]
## Chamber Lighting - CNC_FAN5
pin: PD15
pwm:true
shutdown_value: 0
value:0
cycle_time: 0.01

#####################################################################
#   Additional Sensors
#####################################################################

[temperature_sensor EBB_NTC]
sensor_type: Generic 3950
sensor_pin: EBBCan: PA2

#####################################################################
#   Homing and Gantry Adjustment Routines
#####################################################################

[idle_timeout]
timeout: 1800

##  Use QUAD_GANTRY_LEVEL to level a gantry.
##  Min & Max gantry corners - measure from nozzle at MIN (0,0) and 
##  MAX (250, 250), (300,300), or (350,350) depending on your printer size
##  to respective belt positions
[quad_gantry_level]

gantry_corners:
   -60,-10
   360,310
##  Probe points
points:
   50,50
   50,250
   250,250
   250,50

speed: 400
horizontal_move_z: 5
retries: 5
retry_tolerance: 0.01
max_adjust: 10

#####################################################################
#   Bed Mesh Parameters
#####################################################################

#[bed_mesh]
#speed: 120
#horizontal_move_z: 5
#mesh_min: 15, 15
#mesh_max: 285, 285
#probe_count: 5, 5
#fade_start: 1
#fade_end: 10

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 37.466
#*# pid_ki = 1.189
#*# pid_kd = 295.045
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 20.872
#*# pid_ki = 1.718
#*# pid_kd = 63.398
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.162297, -0.165877, -0.157351, -0.160835, -0.152160, -0.150530, -0.144487, -0.139194, -0.135447, -0.118517, -0.105423, -0.088937, -0.075712, -0.060526, -0.046488, -0.035815, -0.024769, -0.033835, -0.031770, -0.044718, -0.062362, -0.074949, -0.096530, -0.102322, -0.114941, -0.123122, -0.132143, -0.141453, -0.139736, -0.148900
#*# 	  -0.149018, -0.145911, -0.148194, -0.142516, -0.144890, -0.143136, -0.130922, -0.135662, -0.120020, -0.110108, -0.097452, -0.081286, -0.069920, -0.047692, -0.040116, -0.022575, -0.028754, -0.028024, -0.036177, -0.043310, -0.051669, -0.075042, -0.085019, -0.103336, -0.109756, -0.121661, -0.126382, -0.128716, -0.136868, -0.136262
#*# 	  -0.126277, -0.139248, -0.133218, -0.124610, -0.129140, -0.121587, -0.127137, -0.118697, -0.112356, -0.094012, -0.082300, -0.068330, -0.056476, -0.043971, -0.027989, -0.019424, -0.010507, -0.020460, -0.027607, -0.037123, -0.053113, -0.059889, -0.087041, -0.087377, -0.104257, -0.115658, -0.122177, -0.129539, -0.124060, -0.137187
#*# 	  -0.117889, -0.118780, -0.115597, -0.110188, -0.118033, -0.104342, -0.111835, -0.102827, -0.092261, -0.079812, -0.059864, -0.056133, -0.031059, -0.030442, -0.017543, -0.004717, -0.008211, -0.006885, -0.021777, -0.024025, -0.041326, -0.055211, -0.066646, -0.080733, -0.084743, -0.102803, -0.103752, -0.116181, -0.117555, -0.114310
#*# 	  -0.112116, -0.098387, -0.106337, -0.092856, -0.095014, -0.092315, -0.091593, -0.090469, -0.073734, -0.061861, -0.045465, -0.037419, -0.020862, -0.013226, -0.002618, 0.007599, -0.002893, 0.004109, -0.013984, -0.019738, -0.031415, -0.045096, -0.053684, -0.075792, -0.076013, -0.093213, -0.097630, -0.106835, -0.104190, -0.095769
#*# 	  -0.098967, -0.102887, -0.095059, -0.095323, -0.090458, -0.083934, -0.088014, -0.071643, -0.073154, -0.056425, -0.042159, -0.029008, -0.009418, -0.010504, 0.005770, -0.000720, 0.006279, 0.002216, -0.004723, -0.013197, -0.028156, -0.034643, -0.051855, -0.059290, -0.071337, -0.081652, -0.087731, -0.098425, -0.092645, -0.096423
#*# 	  -0.118474, -0.108287, -0.109293, -0.105727, -0.096268, -0.101711, -0.087634, -0.089502, -0.076656, -0.065777, -0.051820, -0.036957, -0.028808, -0.014113, -0.016732, -0.007645, -0.006375, -0.015353, -0.011587, -0.030286, -0.029428, -0.045693, -0.055921, -0.070830, -0.079258, -0.086609, -0.096941, -0.099278, -0.108385, -0.098902
#*# 	  -0.125663, -0.130058, -0.120543, -0.124374, -0.111081, -0.112213, -0.107013, -0.096074, -0.095914, -0.077567, -0.072692, -0.054712, -0.040963, -0.033738, -0.023266, -0.030003, -0.020015, -0.031097, -0.028221, -0.040754, -0.047065, -0.061814, -0.073023, -0.082134, -0.094274, -0.100844, -0.110974, -0.109422, -0.113112, -0.114390
#*# 	  -0.134079, -0.139565, -0.126964, -0.130420, -0.119263, -0.120791, -0.116720, -0.110954, -0.102702, -0.085389, -0.079469, -0.061098, -0.052553, -0.043422, -0.039762, -0.038393, -0.029638, -0.040268, -0.036046, -0.049375, -0.060865, -0.073996, -0.086929, -0.087460, -0.105058, -0.106748, -0.115972, -0.118981, -0.114204, -0.119131
#*# 	  -0.130505, -0.128664, -0.123513, -0.116982, -0.117161, -0.119177, -0.112502, -0.109989, -0.092989, -0.083694, -0.072021, -0.058975, -0.051417, -0.039984, -0.037481, -0.027159, -0.029268, -0.026623, -0.034317, -0.044642, -0.054936, -0.074376, -0.078199, -0.093919, -0.094912, -0.106393, -0.108429, -0.106876, -0.111216, -0.104424
#*# 	  -0.117531, -0.123220, -0.112852, -0.111055, -0.107974, -0.106323, -0.104391, -0.089882, -0.087183, -0.069347, -0.063220, -0.048788, -0.040477, -0.035974, -0.026139, -0.027954, -0.019838, -0.020512, -0.025567, -0.033441, -0.051818, -0.057927, -0.075059, -0.076315, -0.089338, -0.095580, -0.096263, -0.104466, -0.099279, -0.103772
#*# 	  -0.114430, -0.112646, -0.108784, -0.098857, -0.103868, -0.093960, -0.093931, -0.079804, -0.073288, -0.065551, -0.047980, -0.044845, -0.027062, -0.025602, -0.020440, -0.014671, -0.015614, -0.009337, -0.018803, -0.021811, -0.034134, -0.049101, -0.058587, -0.072390, -0.076109, -0.090097, -0.087581, -0.094555, -0.096361, -0.094483
#*# 	  -0.110106, -0.098368, -0.097669, -0.087021, -0.090147, -0.083903, -0.078436, -0.068803, -0.059860, -0.051359, -0.038548, -0.032688, -0.023149, -0.020196, -0.011444, -0.005429, -0.003998, -0.002663, -0.010743, -0.010128, -0.028075, -0.032247, -0.048443, -0.056860, -0.062510, -0.076834, -0.077829, -0.088258, -0.086919, -0.088404
#*# 	  -0.097915, -0.095935, -0.087806, -0.084302, -0.078666, -0.070171, -0.068862, -0.059215, -0.058658, -0.044444, -0.033913, -0.023369, -0.013079, -0.013526, 0.001153, 0.000187, 0.006258, 0.004783, -0.001240, -0.006506, -0.016760, -0.028685, -0.039156, -0.046737, -0.052356, -0.063061, -0.067751, -0.077988, -0.079174, -0.084738
#*# 	  -0.105245, -0.092170, -0.091399, -0.085465, -0.078198, -0.073411, -0.064211, -0.064224, -0.053589, -0.044688, -0.033253, -0.021573, -0.015628, -0.005401, -0.001338, 0.005294, 0.010275, 0.007878, 0.008631, -0.006397, -0.008996, -0.028218, -0.033158, -0.040616, -0.048890, -0.056330, -0.065715, -0.069752, -0.078314, -0.079925
#*# 	  -0.100944, -0.099082, -0.089673, -0.091218, -0.076317, -0.074574, -0.070650, -0.061022, -0.058384, -0.045265, -0.039387, -0.027282, -0.018226, -0.010647, 0.000417, 0.005169, 0.012456, 0.011626, 0.005393, -0.000694, -0.013153, -0.021797, -0.033803, -0.039296, -0.047744, -0.055251, -0.065876, -0.070418, -0.078395, -0.078978
#*# 	  -0.101866, -0.097571, -0.091281, -0.089527, -0.078325, -0.080881, -0.071170, -0.064563, -0.057731, -0.045217, -0.036904, -0.026216, -0.020025, -0.009642, -0.002127, 0.005820, 0.011854, 0.010910, 0.011799, -0.001688, -0.008861, -0.017699, -0.028882, -0.033974, -0.048822, -0.053172, -0.066668, -0.068647, -0.075031, -0.076517
#*# 	  -0.089977, -0.086540, -0.080581, -0.079041, -0.068279, -0.070191, -0.060016, -0.058663, -0.045069, -0.037017, -0.028325, -0.019837, -0.012661, 0.000982, 0.003502, 0.014867, 0.013276, 0.016997, 0.013516, 0.009308, -0.000246, -0.012566, -0.018337, -0.028357, -0.036502, -0.048375, -0.056653, -0.059406, -0.067711, -0.066807
#*# 	  -0.074475, -0.074828, -0.067520, -0.066042, -0.060221, -0.057421, -0.051433, -0.044100, -0.035732, -0.025773, -0.013812, -0.007627, -0.000536, 0.007510, 0.017505, 0.019344, 0.025733, 0.023489, 0.024398, 0.017534, 0.008587, 0.000807, -0.009934, -0.014406, -0.024890, -0.038856, -0.043634, -0.052103, -0.055181, -0.054711
#*# 	  -0.073363, -0.071439, -0.069157, -0.059459, -0.058003, -0.052659, -0.047657, -0.041601, -0.029893, -0.020165, -0.007663, -0.001942, 0.008619, 0.016137, 0.024180, 0.030506, 0.029086, 0.033753, 0.029827, 0.025643, 0.016172, 0.007050, -0.001878, -0.007960, -0.018554, -0.029025, -0.038814, -0.045896, -0.050246, -0.046910
#*# 	  -0.076800, -0.073185, -0.069843, -0.063076, -0.059827, -0.056455, -0.049042, -0.043092, -0.032158, -0.020285, -0.006269, 0.002480, 0.012519, 0.018775, 0.028055, 0.031839, 0.034468, 0.037399, 0.032250, 0.025257, 0.016287, 0.007812, -0.001120, -0.007456, -0.014920, -0.027578, -0.035042, -0.042764, -0.045495, -0.045690
#*# 	  -0.084428, -0.080673, -0.076856, -0.072346, -0.069251, -0.063425, -0.059522, -0.048865, -0.041904, -0.027014, -0.015934, -0.004181, 0.007538, 0.014669, 0.024425, 0.030291, 0.030654, 0.031979, 0.027328, 0.017073, 0.008111, -0.000721, -0.009464, -0.016032, -0.021957, -0.031435, -0.040795, -0.047324, -0.051929, -0.050956
#*# 	  -0.094200, -0.088386, -0.085171, -0.080260, -0.074765, -0.071920, -0.062755, -0.059888, -0.049896, -0.039823, -0.025480, -0.014372, -0.001784, 0.007560, 0.017154, 0.023022, 0.023130, 0.022375, 0.017048, 0.006889, 0.000767, -0.009339, -0.016494, -0.025303, -0.032297, -0.040297, -0.048777, -0.050834, -0.058325, -0.058149
#*# 	  -0.096512, -0.093783, -0.089923, -0.085560, -0.080599, -0.077505, -0.071033, -0.066240, -0.056410, -0.048018, -0.032029, -0.019257, -0.006170, 0.006244, 0.012297, 0.016282, 0.015827, 0.016797, 0.008791, 0.002900, -0.007403, -0.015373, -0.025454, -0.032431, -0.038375, -0.047464, -0.055548, -0.059667, -0.065432, -0.062895
#*# 	  -0.102160, -0.096834, -0.092212, -0.089004, -0.082976, -0.080766, -0.074786, -0.070396, -0.062430, -0.049640, -0.035171, -0.020719, -0.004958, 0.006882, 0.016492, 0.018510, 0.020557, 0.016616, 0.012059, 0.001390, -0.009242, -0.017752, -0.029624, -0.036948, -0.042441, -0.053363, -0.060418, -0.065437, -0.068772, -0.067141
#*# 	  -0.097933, -0.095594, -0.093693, -0.089279, -0.085725, -0.082613, -0.076726, -0.072560, -0.064612, -0.053349, -0.036618, -0.023811, -0.005285, 0.006301, 0.015965, 0.019841, 0.020563, 0.017247, 0.010053, -0.001249, -0.012020, -0.022767, -0.034610, -0.041389, -0.048784, -0.061047, -0.068355, -0.073803, -0.074906, -0.071477
#*# 	  -0.101174, -0.101465, -0.097996, -0.094797, -0.090555, -0.088078, -0.085064, -0.079706, -0.074056, -0.061196, -0.045979, -0.031884, -0.015112, -0.001477, 0.009894, 0.013319, 0.014779, 0.011128, 0.005063, -0.006859, -0.020363, -0.030909, -0.042382, -0.051611, -0.059106, -0.069252, -0.076071, -0.080639, -0.079957, -0.078138
#*# 	  -0.109120, -0.108012, -0.104837, -0.102539, -0.098279, -0.097133, -0.093591, -0.088858, -0.079932, -0.070491, -0.054691, -0.041507, -0.023854, -0.010693, 0.002413, 0.008331, 0.009827, 0.005380, -0.001751, -0.014159, -0.025833, -0.037551, -0.051208, -0.060573, -0.069750, -0.078314, -0.085887, -0.087253, -0.088040, -0.085195
#*# 	  -0.118612, -0.114595, -0.115939, -0.112722, -0.109638, -0.108461, -0.103232, -0.098743, -0.091636, -0.080013, -0.064669, -0.051579, -0.035206, -0.019676, -0.009093, -0.001210, -0.001241, -0.004665, -0.010957, -0.023242, -0.035002, -0.048031, -0.059268, -0.071943, -0.080117, -0.090239, -0.097732, -0.098604, -0.098933, -0.095979
#*# 	  -0.111305, -0.111684, -0.114894, -0.114069, -0.108443, -0.106050, -0.099557, -0.094454, -0.085398, -0.074458, -0.059903, -0.047588, -0.031127, -0.018829, -0.006500, -0.001304, -0.000220, -0.005196, -0.011726, -0.022437, -0.036396, -0.048319, -0.060616, -0.074423, -0.083102, -0.092844, -0.101485, -0.103739, -0.103103, -0.101010
#*# x_count = 30
#*# y_count = 30
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 35.0
#*# max_x = 265.0
#*# min_y = 35.0
#*# max_y = 265.0
#*#
#*# [scanner]
#*# mode = touch
#*# scanner_touch_threshold = 2100
#*# scanner_touch_speed = 3
#*#
#*# [scanner model default]
#*# model_coef = 1.5093237227271483,
#*# 	1.8469554612821597,
#*# 	0.7739062939596321,
#*# 	0.35565995830498726,
#*# 	0.4266643082503246,
#*# 	0.449849813143914,
#*# 	-0.3484068008610224,
#*# 	-0.49452843748538045,
#*# 	0.28806693230193353,
#*# 	0.2929518250392677
#*# model_domain = 3.181691831557491e-07,3.3164638059495333e-07
#*# model_range = 0.200000,5.100000
#*# model_temp = 26.616538
#*# model_offset = 0.00000
#*# model_mode = touch
#*# model_fw_version = CARTOGRAPHER 5.0.0
