# See docs/Config_Reference.md for a description of parameters.

[include stealthburner_leds.cfg]
[include fluidd.cfg]
#[include mainsail.cfg]
[include macros.cfg]
[include config_backup.cfg]
[include homing.cfg]
[include ebbcan.cfg]
[include nozzle_scrub.cfg]
[include bttsfs.cfg]
[include cartographer.cfg]
[include filament.cfg]

[exclude_object]

[force_move]
enable_force_move: True

[mcu]
canbus_uuid: 0f62cf317224

[mcu EBBCan]
canbus_uuid: 77d68f365864

[mcu scanner]
canbus_uuid: 1f11a464b055

[printer]
kinematics: corexy
max_velocity: 500  
max_accel: 20000             #Max 4000
max_z_velocity: 15          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 500
square_corner_velocity: 5.0

[save_variables]
filename: ~/printer_data/config/variables.cfg

[input_shaper]
shaper_freq_x: 58.4
shaper_type_x: mzv
shaper_freq_y: 46.2
shaper_type_y: mzv

[respond]
default_type: echo
#   Sets the default prefix of the "M118" and "RESPOND" output to one
#   of the following:
#       echo: "echo: " (This is the default)
#       command: "// "
#       error: "!! "
#default_prefix: echo:
#   Directly sets the default prefix. If present, this value will
#   override the "default_type".

#####################################################################
#   X/Y Stepper Settings
#####################################################################

##  B Stepper - Left
[stepper_x]
step_pin: PF13
dir_pin: PF12
enable_pin: !PF14
rotation_distance: 40
microsteps: 32
full_steps_per_rotation:400  #set to 200 for 1.8 degree stepper
endstop_pin: tmc2209_stepper_x:virtual_endstop
position_min: 0
position_endstop: 301.5
position_max: 301.5
homing_speed: 40   #Max 100
homing_retract_dist: 0
homing_positive_dir: true

[tmc2209 stepper_x]
uart_pin: PC4
diag_pin: ^PG6
driver_SGTHRS: 144
interpolate: false
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

##  A Stepper - Right
[stepper_y]
step_pin: PG0
dir_pin: PG1
enable_pin: !PF15
rotation_distance: 40
microsteps: 32
full_steps_per_rotation:400  #set to 200 for 1.8 degree stepper
endstop_pin: tmc2209_stepper_y:virtual_endstop
position_min: 0
position_endstop: 305
position_max: 305
homing_speed: 40  #Max 100
homing_retract_dist: 0
homing_positive_dir: true

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_y]
uart_pin: PD11
diag_pin: ^PG9
driver_SGTHRS: 144
interpolate: false
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0
 
#####################################################################
#   Z Stepper Settings
#####################################################################

## Z0 Stepper - Front Left
[stepper_z]
step_pin: PF11
dir_pin: PG3
enable_pin: !PG5
rotation_distance: 40
gear_ratio: 80:16
microsteps: 32
endstop_pin: probe:z_virtual_endstop
position_max: 260
position_min: -5
homing_speed: 8
second_homing_speed: 3
homing_retract_dist: 0 # Was 3 with Tap

[tmc2209 stepper_z]
uart_pin: PC6
interpolate: false
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 999999

##  Z1 Stepper - Rear Left
[stepper_z1]
step_pin: PG4
dir_pin: !PC1
enable_pin: !PA0
rotation_distance: 40
gear_ratio: 80:16
microsteps: 32

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_z1]
uart_pin: PC7
interpolate: false
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 999999

##  Z2 Stepper - Rear Right
[stepper_z2]
step_pin: PF9
dir_pin: PF10
enable_pin: !PG2
rotation_distance: 40
gear_ratio: 80:16
microsteps: 32

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_z2]
uart_pin: PF2
interpolate: false
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 999999

##  Z3 Stepper - Front Right
[stepper_z3]
step_pin: PC13
dir_pin: !PF0
enable_pin: !PF1
rotation_distance: 40
gear_ratio: 80:16
microsteps: 32

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_z3]
uart_pin: PE4
interpolate: false
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 999999


#####################################################################
#   Extruder
#####################################################################

[extruder]
step_pin: EBBCan: PD0
dir_pin: EBBCan: PD1
enable_pin: !EBBCan: PD2
rotation_distance: 22.6789511
gear_ratio: 50:10
microsteps: 32
full_steps_per_rotation: 200    #200 for 1.8 degree, 400 for 0.9 degree
nozzle_diameter: 0.400
filament_diameter: 1.75
heater_pin: EBBCan: PB13
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: EBBCan: PA3
min_temp: 10
max_temp: 300
max_power: 1.0
min_extrude_temp: 70
max_extrude_only_distance: 500
#control = pid
#pid_kp = 26.213
#pid_ki = 1.304
#pid_kd = 131.721
##  Try to keep pressure_advance below 1.0
pressure_advance: 0.035
##  Default is 0.040, leave stock
#pressure_advance_smooth_time: 0.040

##  E0 on MOTOR6
##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 extruder]
uart_pin: EBBCan: PA15
interpolate: false
run_current: 0.78
sense_resistor: 0.110
stealthchop_threshold: 0


#####################################################################
#   Bed Heater
#####################################################################

[heater_bed]
heater_pin: PA2
##  Validate the following thermistor type to make sure it is correct
##  Keenovo branded bed heaters should use Generic 3950
##  LDO branded bed heaters will have the sensor type labelled on the heater
## Check what thermistor type you have. See https://www.klipper3d.org/Config_Reference.html#common-thermistors for common thermistor types.
## Use "Generic 3950" for Keenovo heaters
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF3
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.6
min_temp: 0
max_temp: 120
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769


#####################################################################
#   Fan Control
#####################################################################

##  Print Cooling Fan - FAN0
[fan]
pin: EBBCan: PA1
kick_start_time: 0.5
##  Depending on your fan, you may need to increase this value
##  if your fan will not start. Can change cycle_time (increase)
##  if your fan is not able to slow down effectively
off_below: 0.10


##  Hotend Fan - FAN1
[heater_fan hotend_fan]
pin: EBBCan: PA0
max_power: 1.0
kick_start_time: 0.5
heater: extruder
heater_temp: 50.0
##  If you are experiencing back flow, you can reduce fan_speed
#fan_speed: 1.0

##  Controller fan - FAN2
[controller_fan controller_fan]
pin: PD12
kick_start_time: 0.56
fan_speed: 0.5
stepper: stepper_z

#####################################################################
#   LED Control
#####################################################################

[output_pin caselight]
## Chamber Lighting - CNC_FAN5
pin: PD15
pwm:true
shutdown_value: 0
value:0
cycle_time: 0.01

#####################################################################
#   Additional Sensors
#####################################################################

[temperature_sensor EBB_NTC]
sensor_type: Generic 3950
sensor_pin: EBBCan: PA2

#####################################################################
#   Homing and Gantry Adjustment Routines
#####################################################################

[idle_timeout]
timeout: 1800

##  Use QUAD_GANTRY_LEVEL to level a gantry.
##  Min & Max gantry corners - measure from nozzle at MIN (0,0) and 
##  MAX (250, 250), (300,300), or (350,350) depending on your printer size
##  to respective belt positions
[quad_gantry_level]

gantry_corners:
   -60,-10
   360,310
##  Probe points
points:
   50,50
   50,250
   250,250
   250,50

speed: 400
horizontal_move_z: 5
retries: 5
retry_tolerance: 0.01
max_adjust: 10

#####################################################################
#   Bed Mesh Parameters
#####################################################################

#[bed_mesh]
#speed: 120
#horizontal_move_z: 5
#mesh_min: 15, 15
#mesh_max: 285, 285
#probe_count: 5, 5
#fade_start: 1
#fade_end: 10

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 37.466
#*# pid_ki = 1.189
#*# pid_kd = 295.045
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 20.872
#*# pid_ki = 1.718
#*# pid_kd = 63.398
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.045544, -0.054410, -0.061206, -0.057523, -0.068067, -0.062787, -0.062975, -0.052540, -0.042363, -0.036939, -0.022943, -0.017505, -0.003888, 0.004207, 0.014897, 0.025074, 0.028372, 0.033570, 0.027621, 0.024491, 0.007646, 0.004600, -0.005825, -0.017614, -0.020663, -0.038258, -0.039586, -0.044232, -0.048815, -0.047104
#*# 	  -0.051284, -0.062975, -0.060611, -0.063108, -0.064150, -0.065381, -0.059891, -0.057420, -0.048804, -0.038762, -0.026267, -0.013786, -0.002335, 0.007498, 0.013193, 0.022678, 0.027086, 0.028662, 0.026528, 0.018988, 0.008432, -0.002153, -0.013973, -0.024115, -0.032049, -0.039632, -0.045227, -0.052030, -0.055015, -0.055798
#*# 	  -0.049280, -0.055311, -0.060817, -0.057463, -0.062144, -0.057790, -0.046697, -0.051365, -0.037621, -0.032210, -0.020356, -0.009756, 0.005935, 0.019292, 0.022295, 0.032902, 0.024021, 0.029946, 0.019797, 0.018422, 0.015609, -0.000910, -0.007960, -0.030269, -0.032721, -0.042584, -0.046072, -0.049986, -0.054011, -0.049487
#*# 	  -0.041677, -0.051505, -0.042769, -0.043998, -0.041852, -0.042144, -0.042824, -0.035824, -0.033250, -0.016155, -0.009462, 0.010547, 0.017808, 0.027004, 0.036225, 0.034580, 0.040855, 0.033868, 0.031680, 0.024004, 0.016198, 0.006864, -0.005605, -0.015872, -0.026281, -0.027840, -0.037015, -0.044545, -0.045291, -0.048250
#*# 	  -0.040800, -0.031736, -0.029003, -0.028789, -0.024554, -0.034071, -0.028265, -0.023192, -0.018396, -0.002894, 0.000604, 0.019514, 0.027992, 0.042673, 0.045219, 0.046556, 0.046443, 0.037693, 0.032202, 0.020580, 0.018223, 0.010889, 0.001624, -0.005173, -0.017962, -0.022608, -0.033053, -0.032440, -0.034881, -0.034767
#*# 	  -0.025896, -0.020816, -0.024923, -0.020935, -0.019431, -0.019842, -0.019015, -0.013440, -0.007939, 0.000317, 0.011854, 0.025384, 0.039397, 0.047661, 0.051135, 0.049659, 0.044248, 0.038331, 0.032051, 0.024419, 0.016263, 0.011359, 0.004569, -0.004894, -0.013425, -0.020332, -0.024081, -0.029321, -0.031472, -0.028915
#*# 	  -0.035757, -0.025322, -0.034190, -0.029943, -0.029106, -0.030463, -0.022127, -0.013624, -0.012610, -0.003085, 0.000843, 0.017578, 0.029578, 0.035974, 0.042489, 0.037029, 0.034893, 0.019144, 0.019277, 0.009710, 0.003058, 0.000910, -0.008619, -0.013280, -0.026491, -0.031723, -0.036019, -0.037112, -0.034806, -0.038827
#*# 	  -0.045880, -0.042082, -0.045284, -0.043759, -0.045718, -0.041096, -0.036491, -0.035695, -0.026155, -0.019773, -0.008279, 0.002827, 0.011553, 0.018265, 0.020501, 0.019514, 0.014217, 0.007928, 0.002257, -0.007856, -0.013198, -0.024547, -0.025319, -0.035755, -0.037773, -0.045600, -0.046937, -0.052704, -0.055262, -0.052908
#*# 	  -0.055529, -0.049437, -0.050471, -0.049493, -0.059267, -0.054087, -0.052992, -0.048457, -0.039919, -0.031918, -0.019831, -0.014685, -0.001484, 0.000221, 0.008772, 0.007722, 0.005353, 0.002999, -0.013621, -0.015983, -0.026963, -0.033253, -0.042494, -0.047203, -0.053292, -0.056622, -0.063048, -0.065642, -0.068205, -0.067452
#*# 	  -0.054806, -0.049270, -0.055225, -0.056031, -0.056333, -0.055778, -0.051566, -0.053150, -0.042687, -0.035742, -0.023941, -0.008529, -0.001937, 0.005534, 0.008391, 0.010417, 0.007509, -0.000070, -0.005565, -0.012217, -0.021479, -0.033301, -0.042878, -0.047363, -0.053271, -0.059581, -0.064273, -0.066683, -0.067544, -0.066969
#*# 	  -0.053987, -0.048429, -0.054379, -0.053914, -0.056803, -0.052878, -0.048653, -0.045903, -0.036492, -0.033031, -0.018597, -0.007526, 0.002451, 0.009588, 0.015239, 0.019788, 0.010671, 0.007850, -0.005472, -0.005295, -0.014476, -0.026196, -0.033543, -0.044020, -0.047749, -0.058181, -0.060227, -0.061835, -0.061694, -0.057223
#*# 	  -0.058594, -0.056526, -0.055230, -0.056387, -0.052429, -0.053299, -0.050130, -0.048569, -0.043346, -0.033534, -0.021074, -0.006972, -0.001408, 0.006762, 0.012824, 0.016047, 0.015204, 0.010568, 0.001168, -0.004174, -0.010510, -0.022434, -0.035529, -0.038698, -0.042484, -0.050087, -0.057129, -0.057559, -0.059128, -0.058835
#*# 	  -0.060868, -0.059391, -0.056121, -0.058387, -0.055572, -0.054502, -0.049107, -0.046898, -0.039917, -0.033279, -0.021432, -0.013994, -0.002130, 0.005479, 0.017005, 0.019887, 0.019852, 0.015001, 0.005057, 0.000312, -0.008658, -0.018763, -0.029495, -0.036875, -0.039587, -0.045039, -0.052798, -0.055243, -0.057062, -0.055855
#*# 	  -0.063622, -0.061248, -0.062192, -0.062020, -0.057427, -0.055251, -0.051266, -0.048575, -0.043591, -0.035682, -0.027711, -0.013367, -0.005346, 0.004271, 0.014034, 0.019771, 0.020291, 0.016186, 0.006723, -0.002051, -0.012129, -0.022487, -0.033300, -0.040091, -0.045522, -0.048649, -0.057605, -0.060815, -0.062364, -0.062173
#*# 	  -0.070873, -0.072943, -0.071058, -0.071484, -0.066128, -0.062520, -0.056574, -0.050156, -0.046376, -0.040518, -0.031622, -0.021703, -0.012022, -0.004069, 0.009432, 0.008254, 0.012775, 0.007280, -0.000851, -0.011844, -0.021946, -0.028959, -0.042186, -0.049648, -0.057604, -0.059970, -0.062491, -0.069606, -0.073367, -0.077097
#*# 	  -0.083997, -0.082065, -0.082351, -0.080864, -0.076984, -0.074981, -0.066418, -0.059661, -0.055595, -0.048431, -0.039756, -0.029206, -0.019448, -0.013381, -0.005006, -0.000982, 0.000426, -0.000415, -0.009030, -0.015681, -0.025997, -0.035871, -0.044196, -0.054500, -0.061366, -0.066661, -0.070320, -0.075954, -0.081071, -0.082547
#*# 	  -0.092019, -0.093110, -0.091450, -0.089666, -0.086943, -0.081951, -0.074294, -0.068555, -0.063731, -0.055123, -0.043905, -0.034618, -0.026172, -0.019898, -0.009405, -0.007335, -0.005314, -0.003878, -0.012186, -0.017675, -0.031703, -0.038984, -0.046735, -0.057829, -0.061043, -0.070861, -0.073491, -0.081749, -0.087810, -0.089587
#*# 	  -0.089510, -0.089999, -0.089028, -0.085843, -0.082212, -0.078527, -0.071220, -0.063794, -0.058848, -0.052073, -0.042511, -0.033312, -0.023249, -0.016670, -0.008081, -0.005205, -0.003575, -0.003612, -0.008777, -0.013422, -0.022805, -0.032594, -0.042609, -0.051592, -0.059459, -0.065155, -0.071177, -0.077357, -0.080589, -0.084845
#*# 	  -0.080808, -0.082769, -0.082087, -0.078469, -0.075053, -0.070649, -0.065128, -0.058016, -0.050475, -0.043783, -0.033889, -0.023057, -0.015816, -0.006349, -0.000384, 0.003094, 0.001202, 0.002548, -0.001021, -0.005349, -0.014402, -0.022160, -0.032048, -0.041568, -0.048166, -0.057288, -0.064135, -0.068797, -0.075261, -0.073751
#*# 	  -0.071775, -0.074058, -0.071740, -0.067510, -0.063335, -0.060859, -0.056097, -0.047578, -0.042145, -0.033786, -0.022120, -0.013083, -0.001976, 0.004693, 0.010371, 0.011869, 0.013202, 0.012138, 0.006942, 0.004055, -0.005567, -0.011814, -0.022296, -0.031690, -0.042119, -0.049487, -0.057475, -0.060063, -0.065804, -0.068950
#*# 	  -0.066131, -0.063088, -0.063654, -0.060483, -0.054386, -0.051567, -0.044764, -0.041991, -0.032568, -0.024694, -0.015501, -0.005507, 0.002483, 0.011235, 0.016931, 0.021288, 0.025389, 0.021623, 0.019286, 0.009055, 0.001060, -0.008505, -0.017898, -0.028899, -0.038129, -0.044689, -0.052040, -0.056106, -0.062147, -0.063489
#*# 	  -0.068076, -0.068229, -0.067506, -0.065008, -0.060891, -0.057964, -0.052467, -0.047925, -0.042366, -0.032822, -0.024645, -0.008357, -0.000440, 0.008743, 0.014487, 0.019750, 0.019212, 0.018635, 0.012291, 0.006200, -0.004273, -0.016468, -0.025755, -0.037983, -0.044856, -0.052786, -0.058448, -0.063935, -0.069322, -0.071148
#*# 	  -0.077298, -0.078866, -0.077059, -0.074916, -0.071632, -0.070031, -0.064655, -0.059586, -0.053410, -0.044991, -0.034285, -0.021306, -0.010154, -0.000036, 0.006671, 0.010533, 0.010639, 0.006098, 0.002198, -0.002928, -0.014398, -0.025169, -0.038542, -0.048112, -0.058770, -0.065409, -0.072728, -0.079183, -0.083421, -0.084056
#*# 	  -0.079298, -0.080578, -0.080716, -0.078021, -0.075413, -0.072801, -0.068925, -0.064997, -0.057794, -0.050875, -0.037889, -0.024599, -0.013750, -0.003485, 0.003360, 0.008444, 0.005595, 0.003920, -0.003037, -0.009968, -0.019106, -0.032897, -0.044981, -0.056729, -0.064731, -0.073367, -0.079237, -0.085457, -0.087427, -0.087685
#*# 	  -0.077661, -0.077090, -0.080169, -0.077528, -0.075623, -0.073252, -0.065949, -0.063026, -0.056227, -0.048921, -0.036649, -0.024587, -0.010928, 0.000433, 0.010033, 0.014567, 0.013583, 0.010559, 0.002952, -0.006058, -0.018666, -0.030941, -0.044198, -0.054455, -0.063637, -0.071551, -0.077602, -0.080531, -0.083574, -0.083286
#*# 	  -0.073328, -0.072456, -0.074112, -0.070872, -0.067587, -0.066002, -0.061154, -0.054634, -0.051536, -0.040300, -0.029520, -0.015033, -0.006014, 0.008584, 0.016918, 0.024476, 0.024527, 0.020081, 0.011286, -0.001227, -0.012568, -0.025905, -0.038305, -0.049954, -0.056008, -0.066747, -0.069596, -0.073875, -0.074390, -0.075295
#*# 	  -0.063167, -0.062306, -0.064950, -0.061177, -0.060178, -0.056678, -0.050354, -0.048912, -0.042445, -0.034188, -0.021986, -0.009576, 0.002925, 0.015626, 0.027575, 0.032642, 0.033243, 0.028342, 0.018456, 0.007541, -0.004748, -0.021294, -0.033198, -0.045328, -0.052758, -0.060203, -0.062809, -0.067637, -0.069031, -0.067268
#*# 	  -0.058589, -0.058601, -0.058423, -0.056053, -0.054431, -0.052516, -0.048824, -0.045185, -0.040260, -0.032589, -0.019612, -0.006086, 0.005783, 0.017989, 0.027177, 0.033293, 0.033062, 0.028702, 0.020252, 0.010756, -0.003119, -0.017677, -0.029074, -0.041710, -0.049596, -0.055295, -0.058952, -0.062478, -0.064248, -0.062846
#*# 	  -0.054782, -0.056391, -0.058054, -0.057522, -0.055537, -0.053860, -0.048281, -0.044766, -0.038395, -0.029863, -0.019556, -0.005587, 0.004832, 0.019057, 0.029761, 0.031999, 0.031850, 0.029846, 0.022740, 0.015281, 0.001098, -0.013628, -0.026788, -0.039081, -0.048499, -0.052997, -0.056693, -0.059290, -0.061198, -0.058888
#*# 	  -0.039283, -0.045413, -0.047717, -0.046428, -0.045338, -0.042750, -0.036910, -0.032287, -0.025336, -0.017992, -0.006428, 0.005206, 0.017462, 0.028533, 0.040135, 0.043701, 0.046230, 0.043072, 0.036190, 0.027858, 0.015699, -0.001891, -0.013713, -0.027964, -0.036221, -0.045466, -0.047315, -0.052452, -0.048821, -0.048583
#*# x_count = 30
#*# y_count = 30
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 35.0
#*# max_x = 265.0
#*# min_y = 35.0
#*# max_y = 265.0
#*#
#*# [scanner]
#*# mode = touch
#*# scanner_touch_threshold = 2100
#*# scanner_touch_speed = 3
#*# scanner_touch_z_offset = 0.090
#*#
#*# [scanner model default]
#*# model_coef = 1.5093237227271483,
#*# 	1.8469554612821597,
#*# 	0.7739062939596321,
#*# 	0.35565995830498726,
#*# 	0.4266643082503246,
#*# 	0.449849813143914,
#*# 	-0.3484068008610224,
#*# 	-0.49452843748538045,
#*# 	0.28806693230193353,
#*# 	0.2929518250392677
#*# model_domain = 3.181691831557491e-07,3.3164638059495333e-07
#*# model_range = 0.200000,5.100000
#*# model_temp = 26.616538
#*# model_offset = 0.00000
#*# model_mode = touch
#*# model_fw_version = CARTOGRAPHER 5.0.0
